# FLOW
<img src="https://github.com/SSABOODA/PictureFlow/assets/69753846/d1c941cf-ab81-450b-9bc4-eceaed7438a8" height="100" width="100">

## í”„ë¡œì íŠ¸ ì†Œê°œ
<p align="center" width="100%">
    <img src="https://github.com/SSABOODA/PictureFlow/assets/69753846/fdf26979-fd5e-4121-8500-5bc2d2b2adba" width="100%">
</p>

### ì‘ë™í™”ë©´
|íšŒì›ê°€ì… & ë¡œê·¸ì¸|ê²Œì‹œê¸€ & ëŒ“ê¸€|í•´ì‹œíƒœê·¸ & ì¢‹ì•„ìš”|í”„ë¡œí•„ & íŒ”ë¡œìš°|
|:-:|:-:|:-:|:-:|
|![á„’á…¬á„‹á…¯á†«á„€á…¡á„‹á…µá†¸ á„…á…©á„€á…³á„‹á…µá†«](https://github.com/SSABOODA/PictureFlow/assets/69753846/233c6f0b-e03c-4c44-8d50-a2ffb559341e)|![á„€á…¦á„‰á…µá„€á…³á†¯](https://github.com/SSABOODA/PictureFlow/assets/69753846/6ebc94ec-f5ed-4a48-851f-f6274fe18740)|![á„’á…¢á„‰á…µá„á…¢á„€á…³ á„Œá…©á‡‚á„‹á…¡á„‹á…­](https://github.com/SSABOODA/PictureFlow/assets/69753846/5b6e2510-2bf4-4915-a586-64965ec583a5)|![á„‘á…³á„…á…©á„‘á…µá†¯ á„‘á…¡á†¯á„…á…©á„‹á…µá†¼](https://github.com/SSABOODA/PictureFlow/assets/69753846/9d80dc1f-e609-4b0f-96f1-cf615ff3f3b4)|

<details>
	<summary> 
		<h3>ì£¼ìš” ê¸°ëŠ¥ Screenshot</h3>
	</summary>

### íšŒì›ê°€ì… & ë¡œê·¸ì¸: íšŒì›ê°€ì…ì„ í†µí•´ ìì‹ ì˜ ê²Œì‹œê¸€ì„ ê´€ë¦¬í•˜ê³  íƒ€ì¸ì˜ ê²Œì‹œê¸€ì„ í™•ì¸í•  ìˆ˜ ìˆì–´ìš”
<p align="center" width="100%">
    <img src="https://github.com/SSABOODA/PictureFlow/assets/69753846/44ad5fae-4164-4b99-8084-61b3e64155a9" width="100%">
</p>

### ê²Œì‹œê¸€: ëª¨ë“  ìœ ì €ì˜ ê²Œì‹œê¸€ì„ í™•ì¸í•˜ê³  ì¢‹ì•„ìš” í•  ìˆ˜ ìˆê³ , ëŒ“ê¸€ì„ ë‚¨ê¸¸ ìˆ˜ ìˆì–´ìš”, ì—¬ëŸ¬ ì¥ì˜ ì‚¬ì§„ ë° í•´ì‹œíƒœê·¸ê°€ ë‹´ê¸´ ê²Œì‹œê¸€ë„ ë‚¨ê²¨ë³¼ ìˆ˜ ìˆì–´ìš”
<p align="center" width="100%">
    <img src="https://github.com/SSABOODA/PictureFlow/assets/69753846/932c9744-336f-4e5a-923e-3c2507237b13" width="100%">
</p>

### ì¢‹ì•„ìš” & í•´ì‹œíƒœê·¸: ì¢‹ì•„ìš”í•œ ê²Œì‹œê¸€ê³¼ í•´ì‹œíƒœê·¸ ê²€ìƒ‰ì„ í†µí•´ ê²Œì‹œê¸€ì„ í™•ì¸í•´ë³¼ ìˆ˜ ìˆì–´ìš”
<p align="center" width="100%">
    <img src="https://github.com/SSABOODA/PictureFlow/assets/69753846/01ef441d-5747-4cd9-a8e0-46532d36c636" width="100%">
</p>

### í”„ë¡œí•„ & íŒ”ë¡œìš°: ë‹¤ë¥¸ ìœ ì €ë¥¼ íŒ”ë¡œìš°í•  ìˆ˜ ìˆê³ , ìì‹ ì˜ í”„ë¡œí•„ì—ì„œ ê²Œì‹œê¸€, íŒ”ë¡œì›Œ, íŒ”ë¡œì‰ ëª©ë¡, í”„ë¡œí•„ ìˆ˜ì •ë“±ì„ í•´ë³¼ ìˆ˜ ìˆì–´ìš”
<p align="center" width="100%">
    <img src="https://github.com/SSABOODA/PictureFlow/assets/69753846/174a0cca-68a0-4e6c-9fef-4586960c2cf8" width="100%">
</p>
</details>

### ì•± ì†Œê°œ
ì¼ìƒì˜ ì´ì•¼ê¸°ë¥¼ ê³µìœ í•˜ê³  ìì‹ ì˜ ê²Œì‹œê¸€ì„ ê´€ë¦¬í•˜ê³  ì¶”ì í•´ë³¼ ìˆ˜ ìˆëŠ” Thread ë° Twitter ê¸°ë°˜ SNS ì•±ì…ë‹ˆë‹¤.

### ì£¼ìš” ê¸°ëŠ¥
- **íšŒì›ê°€ì…**, **ë¡œê·¸ì¸**ì„ í†µí•´ ìì‹ ì˜ ê²Œì‹œê¸€ì„ ê´€ë¦¬í•  ìˆ˜ ìˆì–´ìš”
	- ë¡œê·¸ì•„ì›ƒ, íšŒì›íƒˆí‡´ë„ í•´ë³¼ ìˆ˜ ìˆì–´ìš”
- ì´ë¯¸ì§€ë¥¼ í¬í•¨í•œ **ê²Œì‹œê¸€**ì„ ì‘ì„±, ìˆ˜ì •, ì‚­ì œê°€ ê°€ëŠ¥í•´ìš”
- íƒ€ì¸ ê²Œì‹œê¸€ì— **ëŒ“ê¸€** ì‘ì„±, ìˆ˜ì •, ì‚­ì œê°€ ê°€ëŠ¥í•´ìš”
- ê²Œì‹œê¸€ì— ëŒ€í•´ì„œ **ì¢‹ì•„ìš”**ê°€ ê°€ëŠ¥í•´ìš”
- **í•´ì‹œíƒœê·¸**ë¥¼ í†µí•´ ê´€ë ¨ ê²Œì‹œê¸€ì„ ê²€ìƒ‰í•´ë³¼ ìˆ˜ ìˆì–´ìš”
- ë‹¤ë¥¸ ìœ ì €ë¥¼ **íŒ”ë¡œìš°**í•´ë³¼ ìˆ˜ ìˆì–´ìš”
- ë‚˜ì˜ **í”„ë¡œí•„**ì— ê²Œì‹œê¸€, íŒ”ë¡œìš°ë¥¼ ê´€ë¦¬í•´ë³¼ ìˆ˜ ìˆì–´ìš”

### í”„ë¡œì íŠ¸ ê¸°ê°„
- 2023.11.17 ~ 2023.12.17
### í”„ë¡œì íŠ¸ ì°¸ì—¬ ì¸ì›
- 1ëª…(ê°œì¸)

<br>
<br>

## ğŸ› ï¸ ì‚¬ìš©ëœ ê¸°ìˆ  ìŠ¤íƒ
- **Framework**
`UIKit`
- **Library**
`RxSwift`, `RxDatasource`,  `Snapkit`,  `Kingfisher`
`Tabman`, `IQKeyboardManager`
- **Design Pattern**
`MVVM`, `Router`, `Singleton`, `Input/Output`

<br>
<br>

## êµ¬í˜„ ê¸°ëŠ¥
### íšŒì›ê°€ì…, ë¡œê·¸ì¸
- **JWT Token** ê¸°ë°˜ì˜ ë¡œê·¸ì¸ êµ¬í˜„, **Alamofire RequestInterceptor**ë¥¼ í†µí•œ **AccessToken** ê°±ì‹ ê³¼  **RefeshToken** ë§Œë£Œ ë¡œì§ ì²˜ë¦¬
- **ì •ê·œí‘œí˜„ì‹**ì„ í™œìš©í•œ íšŒì›ê°€ì… ì¸ì¦ ë¡œì§ êµ¬í˜„
### ê²Œì‹œê¸€
- **RxSwift**ê¸°ë°˜ TableView, CollectionView UI êµ¬í˜„
- **RxCollectionViewSectionedReloadDataSource**ë¥¼ í™œìš©í•œ ê²Œì‹œê¸€ ìƒì„¸ View UIêµ¬í˜„
- **RxSwift**ê¸°ë°˜ **UIRefreshControl**ë¥¼ í™œìš©í•´ **PullToRefresh** ë¥¼ êµ¬í˜„í•˜ì—¬ ê²Œì‹œê¸€ ë°ì´í„° ê°±ì‹ 
- **Rx prefetchRows** ë¥¼ ì‚¬ìš©í•˜ì—¬ **Cursor** ê¸°ë°˜ **Pagination** êµ¬í˜„
### ë„¤íŠ¸ì›Œí¬
- **Router Pattern**ì„ í™œìš©í•´ ë„¤íŠ¸ì›Œí¬ ê³„ì¸µì˜ ê°€ë…ì„± ì¦ê°€ ë° ì½”ë“œ ì¬ì‚¬ìš©ì„±ì„ ì˜¬ë ¸ìŠµë‹ˆë‹¤.

<br>
<br>
  
## Trouble Shooting
### 1. ìœ ë™ì ì¸ ë†’ì´(dynamic height)ë¥¼ ê°€ì§„ tableHeaderView
#### ë¬¸ì œ ìƒí™©
ìƒë‹¨ HeaderViewì— ìœ ë™ì ì¸ ë†’ì´ë¥¼ ê°€ì§„ ê²Œì‹œê¸€ ë°ì´í„°ì™€ í•˜ë‹¨ì— ê²Œì‹œê¸€ì— ëŒ€í•œ ëŒ“ê¸€ ë¦¬ìŠ¤íŠ¸ë¥¼ tableView í˜•ì‹ìœ¼ë¡œ ê°€ì§„ UIë¥¼ ë§Œë“¤ ë•Œ ìœ ë™ì ì¸ ë†’ì´ë¥¼ ê°€ì§€ëŠ” **Dynamic Height** HeaderViewë¥¼ ë§Œë“¤ ë•Œ ë¬¸ì œê°€ ë°œìƒí•˜ì˜€ìŠµë‹ˆë‹¤.

#### ë¬¸ì œ í•´ê²°
ê²Œì‹œê¸€ ìƒì„¸ Viewì—ì„œëŠ” ì„¹ì…˜ì´ ì—†ì—ˆê¸° ë•Œë¬¸ì— UITableViewì˜ **tableHeaderView** propertyì— custom viewë¥¼ í• ë‹¹í•˜ëŠ” ë°©ì‹ìœ¼ë¡œ í•´ê²°í–ˆìŠµë‹ˆë‹¤. 
**tableHeaderView** ëŠ” UILabel ì»¨í…ì¸ ì— ë”°ë¼ ìë™ìœ¼ë¡œ ë†’ì´ë¥¼ ì¡°ì ˆí•´ì£¼ì§€ ì•Šì•„ ëª¨ë“  ê°ì²´ì˜ Heightë¥¼ ì§ì ‘ ê³„ì‚°í•˜ì—¬ Layoutì„ ë‹¤ì‹œ ê·¸ë¦¬ëŠ” ë°©ì‹ìœ¼ë¡œ í•´ê²°í–ˆìŠµë‹ˆë‹¤.

```swift
final class HeaderView: UIView {
    private let titleLabel = UILabel()
    private let likeButton = UIButton()
    private var contentHeight: CGFloat {
        let height = 
        titleLabel.bounds.height +
        likeButton.bounds.height +
        labelTopDistance +
        labelToButtonBetweenDistance +
         10.0
        return height
    }
    private let labelTopDistance = 5.0
    private let labelToButtonBetweenDistance = 10.0
}
```

```swift
final class TableHeaderViewController: UIViewController {
    override func viewDidLoad() {
        super.viewDidLoad()
        headerView.layoutIfNeeded()
        updateHederViewHeight()
    }
	
    private func updateHederViewHeight() {
        let calculatedHeight: CGFloat = headerView.contentHeight
        headerView.frame = CGRect(
            x: 0,
            y: 0,
            width: view.bounds.width,
            height: calculatedHeight
        )
        tableView.tableHeaderView = headerView
    }
}
```
<br>

### 2. ê²Œì‹œê¸€ ì»¨í…ì¸ ì—ì„œ hash tag í´ë¦­ì‹œ Link ê¸°ëŠ¥ êµ¬í˜„
#### ë¬¸ì œ ìƒí™©
ê²Œì‹œê¸€ì˜ Text ì¤‘ íŠ¹ì • URLì´ ì•„ë‹Œ ì¼ë°˜ í…ìŠ¤íŠ¸ì— **Link** ê¸°ëŠ¥ì„ í†µí•´ í•´ì‹œíƒœê·¸ë¥¼ êµ¬í˜„í•´ì•¼í–ˆìŠµë‹ˆë‹¤.
#### ë¬¸ì œ í•´ê²°
ê²Œì‹œê¸€ì˜ ì»¨í…ì¸ ëŠ” UILabelì˜ Textë¡œ êµ¬í˜„ë˜ì–´ ìˆì—ˆì§€ë§Œ, Link ê¸°ëŠ¥ ì‚¬ìš©í•˜ë ¤ë©´ UITextViewì˜ Linkê¸°ëŠ¥ ì¦‰, attributesë¥¼ ì„¤ì •í•  ë•Œ `data detectors` ì™€ íŠ¹ì • ë¬¸ìì˜ styleì„ ë³€ê²½í•  ìˆ˜ ìˆëŠ” `NSMutableAttributedString` ë¥¼ í™œìš©í•´ í•´ì‹œíƒœì˜ íŠ¹ì • ë¬¸ìì˜ ìƒ‰ìƒ ë³€ê²½ê³¼ linkê¸°ëŠ¥ì„ ì¶”ê°€í•˜ì˜€ìŠµë‹ˆë‹¤.

```swift
final class HashtagTextView: UITextView {
    var hashtagArr: [String]?
    
    func resolveHashTags() {
        self.isEditable = false
        self.isSelectable = true
        
        let nsText: NSString = self.text as NSString
        let attrString = NSMutableAttributedString(string: nsText as String)
        let hashtagDetector = try? NSRegularExpression(
            pattern: "#(\\w+)",
            options: NSRegularExpression.Options.caseInsensitive
        )
        
        let results = hashtagDetector?.matches(
            in: self.text,
            options: NSRegularExpression.MatchingOptions.withoutAnchoringBounds,
            range: NSMakeRange(0, self.text.utf16.count)
        )
        
        let hashtagAttributes: [NSAttributedString.Key: Any] = [
            .font: UIFont.boldSystemFont(ofSize: 18),
            .foregroundColor: UIColor.systemBlue
        ]
        
        let regularTextAttributes: [NSAttributedString.Key: Any] = [
            .font: UIFont.systemFont(ofSize: 18),
            .foregroundColor: UIColor(resource: .text)
        ]
        
        // ê¸°ì¡´ ì†ì„± ì´ˆê¸°í™”
        attrString.removeAttribute(.foregroundColor, range: NSRange(location: 0, length: attrString.length))
        attrString.addAttributes(regularTextAttributes, range: NSRange(location: 0, length: attrString.length))

        hashtagArr = results?.map { (self.text as NSString).substring(with: $0.range(at: 1)) }
        if hashtagArr?.count != 0 {
            var i = 0
            for var word in hashtagArr! {
                word = "#" + word
                if word.hasPrefix("#") {
                    let matchRange:NSRange = nsText.range(of: word as String, options: [.caseInsensitive, .backwards])
                                                                
                    attrString.addAttribute(NSAttributedString.Key.link, value: "\(i)", range: matchRange)
                    attrString.addAttributes(hashtagAttributes, range: matchRange)
                    i += 1
                }
            }
        }
        
        self.attributedText = attrString
    }
}
```
<br>

### 3. Rxswift button tap stream error handling
#### ë¬¸ì œ ìƒí™©
RxSwiftë¡œ ë¡œê·¸ì¸ ë²„íŠ¼ í´ë¦­ ì‹œ ë¡œê·¸ì¸ APIì— Requestë¥¼ ë³´ë‚´ëŠ” ë¡œì§ì„ êµ¬í˜„í•˜ì˜€ëŠ”ë° ë„¤íŠ¸ì›Œí¬ í†µì‹ ì´ ì‹¤íŒ¨í•˜ë©´ í•´ë‹¹ Rx Streamì´ dispose ë˜ì–´ë²„ë¦¬ê³  ë” ì´ìƒ í•´ë‹¹ ë¡œê·¸ì¸ ë²„íŠ¼ì„ ëˆ„ë¥¼ ìˆ˜ ì—†ëŠ” ë¬¸ì œê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.
#### ë¬¸ì œ í•´ê²°
`Single` traitsë¥¼ ì‚¬ìš©í•˜ì—¬ **fetch** ë©”ì„œë“œì—ì„œ ë°©ì¶œí•˜ëŠ” ë‹¨ì¼ **Observable** ì´ë²¤íŠ¸ë¥¼ ë˜í•‘í•˜ì—¬ errorë¥¼ ë°©ì¶œí•˜ì§€ ì•Šê³  í•´ë‹¹ ë²„íŠ¼ streamì—ì„œ ì—ëŸ¬ë¥¼ ì²˜ë¦¬í•˜ëŠ” ë°©ë²•ì„ ì‚¬ìš©í•˜ì˜€ìŠµë‹ˆë‹¤.
- Network.swift
```swift
func fetchSingle<T: Decodable> (
    type: T.Type,
    router: Router
) -> Single<Result<T, AFError>> {
    return Single.create { emitter -> Disposable in
	let request = AF.request(
	    router,
	    interceptor: AuthManager()
	)
	    .validate()
            .responseDecodable(of: T.self) { response in
            switch response.result {
            case .success(let success):
                emitter(.success(.success(success)))
            case .failure(let failure):
                emitter(.success(.failure(failure)))
            }
        }
	return Disposables.create() {
            request.cancel()
	}
    }
}
```

- loginViewModel.swift
```swift
input.loginButtonTap
    .withLatestFrom(loginModelObservable)
    .flatMap {
	Network.shared.fetchSingle(
	    type: LoginResponse.self,
	    router: .login(model: $0)
	)
    }
    .subscribe(with: self) { owner, result in
        switch result {
        case .success(let data):
            print(data)
        case .failure(let error):
            print(error)
        }
    } onError: { owner, error in
	print("Rx login onError")
    } onCompleted: { owner in
	print("Rx login onCompleted")
    } onDisposed: { owner in
	print("Rx login onDisposed")
    }
    .disposed(by: disposeBag)
```
